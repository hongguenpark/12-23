
1) DigiCertGlobalRootCA인증서
curl -O https://cacerts.digicert.com/DigiCertGlobalRootCA.crt.pem


2) Create remote source in HANA DB 

CREATE REMOTE SOURCE DATALAKE ADAPTER "iqodbc" 
    CONFIGURATION 'Driver=libdbodbc17_r.so;host=<이전 단계에서 복사한 SQL Endpoint>;
    ENC=TLS(trusted_certificates=< 이전 단계에서 복사한 DigiCertGlobalRootCA 의 string>;direct=yes)'
    WITH CREDENTIAL TYPE 'PASSWORD' USING 'user=<user_name>;password=<password>';

CREATE REMOTE SOURCE DATALAKE ADAPTER "iqodbc" 
    CONFIGURATION 'Driver=libdbodbc17_r.so;host=a369d9bf-0f86-41bf-9151-ce0f45a30b2b.iq.hdl.trial-us10.hanacloud.ondemand.com:443;
    ENC=TLS(trusted_certificates=
    -----BEGIN CERTIFICATE-----
MIIDrzCCApegAwIBAgIQCDvgVpBCRrGhdWrJWZHHSjANBgkqhkiG9w0BAQUFADBh
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBD
QTAeFw0wNjExMTAwMDAwMDBaFw0zMTExMTAwMDAwMDBaMGExCzAJBgNVBAYTAlVT
MRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsTEHd3dy5kaWdpY2VydC5j
b20xIDAeBgNVBAMTF0RpZ2lDZXJ0IEdsb2JhbCBSb290IENBMIIBIjANBgkqhkiG
9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4jvhEXLeqKTTo1eqUKKPC3eQyaKl7hLOllsB
CSDMAZOnTjC3U/dDxGkAV53ijSLdhwZAAIEJzs4bg7/fzTtxRuLWZscFs3YnFo97
nh6Vfe63SKMI2tavegw5BmV/Sl0fvBf4q77uKNd0f3p4mVmFaG5cIzJLv07A6Fpt
43C/dxC//AH2hdmoRBBYMql1GNXRor5H4idq9Joz+EkIYIvUX7Q6hL+hqkpMfT7P
T19sdl6gSzeRntwi5m3OFBqOasv+zbMUZBfHWymeMr/y7vrTC0LUq7dBMtoM1O/4
gdW7jVg/tRvoSSiicNoxBN33shbyTApOB6jtSj1etX+jkMOvJwIDAQABo2MwYTAO
BgNVHQ8BAf8EBAMCAYYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUA95QNVbR
TLtm8KPiGxvDl7I90VUwHwYDVR0jBBgwFoAUA95QNVbRTLtm8KPiGxvDl7I90VUw
DQYJKoZIhvcNAQEFBQADggEBAMucN6pIExIK+t1EnE9SsPTfrgT1eXkIoyQY/Esr
hMAtudXH/vTBH1jLuG2cenTnmCmrEbXjcKChzUyImZOMkXDiqw8cvpOp/2PV5Adg
06O/nVsJ8dWO41P0jmP6P6fbtGbfYmbW0W5BjfIttep3Sp+dWOIrWcBAI+0tKIJF
PnlUkiaY4IBIqDfv8NZ5YBberOgOzW6sRBc4L0na4UU+Krk2U886UAb3LujEV0ls
YSEY1QSteDwsOoBrp+uvFRTp2InBuThs4pFsiv9kuXclVzDAGySj4dzp30d8tbQk
CAUw7C29C79Fv1C5qfPrmAESrciIxpg0X40KPMbp1ZWVbd4=
-----END CERTIFICATE-----
    ;direct=yes)'
    WITH CREDENTIAL TYPE 'PASSWORD' USING 'user=HDLADMIN;password=Welcome1';


3) Create test table in DataLake
CREATE TABLE "SBOOK"(
	"MANDT" VARCHAR(3) DEFAULT '000' NOT NULL,
	"CARRID" VARCHAR(3) DEFAULT '' NOT NULL,
	"CONNID" VARCHAR(4) DEFAULT '0000' NOT NULL,
	"FLDATE" VARCHAR(8) DEFAULT '00000000' NOT NULL,
	"BOOKID" VARCHAR(8) DEFAULT '00000000' NOT NULL,
	"CUSTOMID" VARCHAR(8) DEFAULT '00000000' NOT NULL,
	"CUSTTYPE" VARCHAR(1) DEFAULT '' NOT NULL,
	"SMOKER" VARCHAR(1) DEFAULT '' NOT NULL,
	"LUGGWEIGHT" DECIMAL(8, 4) DEFAULT 0 NOT NULL,
	"WUNIT" VARCHAR(3) DEFAULT '' NOT NULL,
	"INVOICE" VARCHAR(1) DEFAULT '' NOT NULL,
	"CLASS" VARCHAR(1) DEFAULT '' NOT NULL,
	"FORCURAM" DECIMAL(15, 2) DEFAULT 0 NOT NULL,
	"FORCURKEY" VARCHAR(5) DEFAULT '' NOT NULL,
	"LOCCURAM" DECIMAL(15, 2) DEFAULT 0 NOT NULL,
	"LOCCURKEY" VARCHAR(5) DEFAULT '' NOT NULL,
	"ORDER_DATE" VARCHAR(8) DEFAULT '00000000' NOT NULL,
	"COUNTER" VARCHAR(8) DEFAULT '00000000' NOT NULL,
	"AGENCYNUM" VARCHAR(8) DEFAULT '00000000' NOT NULL,
	"CANCELLED" VARCHAR(1) DEFAULT '' NOT NULL,
	"RESERVED" VARCHAR(1) DEFAULT '' NOT NULL,
	"PASSNAME" VARCHAR(25) DEFAULT '' NOT NULL,
	"PASSFORM" VARCHAR(15) DEFAULT '' NOT NULL,
	"PASSBIRTH" VARCHAR(8) DEFAULT '00000000' NOT NULL
);
SELECT * FROM SBOOK;


4) Create Virtual Table in HANA DB
CREATE SCHEMA EXTERNAL;
DROP TABLE EXTERNAL.VT_SBOOK;
CREATE VIRTUAL TABLE EXTERNAL.VT_SBOOK AT "DATALAKE"."<NULL>"."HDLADMIN"."SBOOK";
SELECT * FROM EXTERNAL.VT_SBOOK;


5) Import data in HANA DB
SFLIGHT.tar.gz


6) Execute read/write Query to DATALAKE via VirtualTable 
SELECT * FROM EXTERNAL.VT_SBOOK;
SELECT * FROM SFLIGHT.SBOOK;
SELECT * FROM SFLIGHT.SBOOK WHERE INVOICE = 'X' AND ORDER_DATE < '20100101';
INSERT INTO "EXTERNAL"."VT_SBOOK" SELECT * FROM SFLIGHT.SBOOK WHERE INVOICE = 'X' AND ORDER_DATE < '20100101';
SELECT * FROM EXTERNAL.VT_SBOOK;

